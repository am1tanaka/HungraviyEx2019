# 吸い寄せられる処理の汎用化

ブラックホールに吸い込む処理はぐらびぃに組み込みましたが、同様の処理は敵やアイテムでも発動します。同じ機能を実装するのは無駄なので、これを使いまわせるようにします。

## 汎用化の手段
オブジェクト指向で検討するなら、吸い寄せ機能を親クラスに持たせて、ぐらびぃ、敵、アイテムはそれを継承するという方法があります。

Unityであれば、ゲームオブジェクトに複数のコンポーネントをアタッチできるので、MonoBehaviourを継承した吸い寄せ機能のみのスクリプトを作成して、必要なオブジェクトにアタッチすることができます。ゲームオブジェクトに多数のMonoBehaviourをアタッチする方法は、ゲームオブジェクトごとに複数のUpdate()呼び出しが発生するため遅くなりやすいという欠点はあります。今回は、数が少なく、ゲーム内容も軽いので問題ないと判断して、こちらで実装を進めます。

# スクリプトの作成
新しいスクリプトSuiyoseを作成して、Enemy00のプレハブにアタッチします。

Graviyスクリプトを見ながら、まずは吸い込みに関する変数やプログラムを移植します。Graviyの処理は、実装が完了するまで残しておきましょう。

Suiyoseは、以下の機能を持ちます。

- Graviyが移動可能な状態の時に有効になり、移動不可の時は停止
- 設定に従ってブラックホールの位置と距離に応じて、吸い込み加速を自動的に行う
- Rigidbody2Dを自分で管理
- Graviyからブラックホールの吸い寄せられる処理をコピーして、public bool Suck()などのメソッドに貼り付ける。このメソッドでは、Time.frameCountを使って、同じフレーム中にすでに一度実行していたら、次はisSuckedをreturnするだけの処理を入れる
- FixedUpdate()にGraviy.CanMoveによる動作制限を入れて、Suck()を呼び出す
- Graviyや敵から、Suck()を呼び出して、戻り値に応じて吸い寄せられた時に関する処理を加える

# 敵を対応させる
敵からSuckedスクリプトを利用します。

- Enemy00スクリプトを開く
- Suiyose suiyose = null;のように宣言して、Awake()でGetComponentする
- FixedUpdate()に、switch(state)を作成して、caseで状態分け
