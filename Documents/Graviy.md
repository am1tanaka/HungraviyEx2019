# ぐらびぃの制御

ブラックホールの制御ができたら、それをもとにぐらびぃの移動を実装できます。ブラックホールの時と同様に、まずは状態の洗い出しから行います。

# ぐらびぃの状態

## 状況を検討
まずは、ゲーム開始からぐらびぃがどのような状況になるかをリストアップします。

- ゲームが開始するまでは移動しない
- ゲームが開始したら、重力落下しつつ、慣性で移動
- ブラックホールが発生したら引き寄せられる
- 敵や障害物にぶつかるとミス
  - 弾き飛ばされて、一定時間無敵
- ライフがなくなるとゲームオーバー
- ゴールに辿り着くとクリア
- ESCキーでポーズ
- お菓子に触れたら食べる

## 状態を決める
以上を元に、入出力が変わるかどうかに着目して、状態を決めていきます。

- 移動なし
  - 開始まで
  - ゲームオーバー
  - クリア
  - ポーズ中
- ブラックホール発生中
  - 吸い寄せられる
- ブラックホール未発生
  - 慣性移動＋落下
- 無敵時間
  - ミスしてから一定時間
- (保留。動きをみて決定)食べるアニメーション
  - 速度を保存しておいて、アニメ中は移動を停止

## 動作用の変数を決める
状態は、以下の変数で制御できそうです。

- 移動可能かどうかのCanMoveフラグ
- Blackhole.IsSpawnで、ブラックホールの発生状態を確認
- 残りの無敵秒数を入れておくfloat変数`mutekiTime`
- (保留)食べるアニメ中フラグ

これもシンプルなので、状態を管理する変数はなしでよいでしょう。

## アニメーションを決める
ぐらびぃのアニメは以下の種類があります。

- Fall 落下
- Hungry はらぺこ
- Idle 通常時
- Sucked ブラックホールに吸い込み
- Inhale 食べる





状態は、操作と動作が同じかどうかで切り分けていくと分かりやすいです。


- 画面内をクリックすると、ブラックホールが出現する
  - ブラックホールに向かって、プレイヤーは吸い寄せられる
  - 吸い寄せは、ボタンを押した瞬間から有効
- マウスドラッグで、ブラックホールも移動。最高速度あり
- ボタンを離すとブラックホール消滅
  - 消滅中は、吸い寄せ効果はなくなる
- 敵やトゲに触れるとミス
  - ライフが減る
  - 一定時間無敵になる
  - 少しノックバック
  - 操作は可能
  - ライフが無くなると
